<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ðŸ“Š Real-time Sensor Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            margin: 0;
        }
        nav {
            width: 200px;
            background-color: #2c3e50;
            color: white;
            height: 100vh;
            padding-top: 1em;
        }
        nav a {
            display: block;
            color: white;
            padding: 1em;
            text-decoration: none;
        }
        nav a:hover {
            background-color: #34495e;
        }
        main {
            flex-grow: 1;
            padding: 2em;
            background-color: #f4f4f4;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1em;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        tr:hover { background-color: #f1f1f1; }
        .pagination button {
            margin: 0.5em;
        }
    </style>
</head>
<body>
    <nav>
        <a href="#" onclick="showPage('log')">Log Table</a>
        <a href="#" onclick="showPage('graph')">Sensor Graph</a>
        <a href="#" onclick="showPage('stream')">Camera Stream</a>
    </nav>
    <main>
        <section id="log-page">
            <h2>ðŸ“Š Sensor Log (10 per page)</h2>
            <table id="log-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Accel X</th>
                        <th>Accel Y</th>
                        <th>Accel Z</th>
                        <th>Gyro X</th>
                        <th>Gyro Y</th>
                        <th>Gyro Z</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="pagination">
                <button onclick="changePage(-1)">&laquo; Prev</button>
                <span id="page-number">Page 1</span>
                <button onclick="changePage(1)">Next &raquo;</button>
            </div>
        </section>

        <section id="graph-page" style="display:none">
            <h2>ðŸ“ˆ Real-time Accelerometer Graph</h2>
            <canvas id="sensorChart"></canvas>
        </section>

        <section id="stream-page" style="display:none">
            <h2>ðŸ“¹ Camera Stream (Coming soon)</h2>
            <p>ESP32-CAM stream will appear here.</p>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let page = 1;
        const apiBase = "https://test-flask-mongo.onrender.com";

        async function loadLogs() {
            const res = await fetch(`${apiBase}/data?page=${page}`);
            const data = await res.json();
            const tbody = document.querySelector("#log-table tbody");
            tbody.innerHTML = "";
            data.forEach(row => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${row.timestamp}</td>
                    <td>${row.accel_x}</td>
                    <td>${row.accel_y}</td>
                    <td>${row.accel_z}</td>
                    <td>${row.gyro_x}</td>
                    <td>${row.gyro_y}</td>
                    <td>${row.gyro_z}</td>`;
                tbody.appendChild(tr);
            });
            document.getElementById("page-number").textContent = `Page ${page}`;
        }

        function changePage(delta) {
            page = Math.max(1, Math.min(page + delta, 10));
            loadLogs();
        }

        let chart;
        async function updateGraph() {
            const res = await fetch(`${apiBase}/latest`);
            const data = await res.json();
            const labels = data.map(d => d.timestamp);
            const ax = data.map(d => d.accel_x);
            const ay = data.map(d => d.accel_y);
            const az = data.map(d => d.accel_z);

            if (!chart) {
                const ctx = document.getElementById("sensorChart").getContext("2d");
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: 'Accel X', data: ax, borderColor: 'red', fill: false },
                            { label: 'Accel Y', data: ay, borderColor: 'green', fill: false },
                            { label: 'Accel Z', data: az, borderColor: 'blue', fill: false }
                        ]
                    },
                    options: { responsive: true }
                });
            } else {
                chart.data.labels = labels;
                chart.data.datasets[0].data = ax;
                chart.data.datasets[1].data = ay;
                chart.data.datasets[2].data = az;
                chart.update();
            }
        }

        setInterval(updateGraph, 2000);

        function showPage(id) {
            document.getElementById("log-page").style.display = id === 'log' ? "block" : "none";
            document.getElementById("graph-page").style.display = id === 'graph' ? "block" : "none";
            document.getElementById("stream-page").style.display = id === 'stream' ? "block" : "none";
        }

        loadLogs();
    </script>
</body>
</html>
