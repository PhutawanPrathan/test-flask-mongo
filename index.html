<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üìä Real-time Sensor Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f9f9f9;
    }
    .container {
      display: flex;
      height: 100vh;
    }
    aside {
      width: 220px;
      background-color: #333;
      color: white;
      padding: 1rem;
    }
    aside h2 {
      font-size: 1.2rem;
      margin-top: 0;
    }
    aside ul {
      list-style: none;
      padding: 0;
    }
    aside li {
      padding: 10px;
      cursor: pointer;
    }
    aside li:hover, aside li.active {
      background-color: #4CAF50;
    }
    main {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }
    h2 {
      color: #333;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background-color: white;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px;
      text-align: center;
      border: 1px solid #ddd;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }
    tr:hover {
      background-color: #f1f1f1;
    }
    .pagination {
      margin-top: 1rem;
      text-align: center;
    }
    .pagination button {
      padding: 0.5rem 1rem;
      margin: 0 0.25rem;
      border: none;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      border-radius: 4px;
    }
    .pagination button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="container">
    <aside>
      <h2>üìÅ Dashboard</h2>
      <ul>
        <li class="active" onclick="showPage('log')">üìÑ Log Table</li>
        <li onclick="showPage('graph')">üìà Sensor Graph</li>
        <li onclick="showPage('stream')">üì∑ Camera Stream</li>
      </ul>
    </aside>
    <main>
      <!-- Page 1: Log Table -->
      <section id="log-page">
        <h2>üìÑ Real-time MPU6050 Log</h2>
        <table id="data-table">
          <thead>
            <tr>
              <th>Timestamp</th>
              <th>Accel X</th>
              <th>Accel Y</th>
              <th>Accel Z</th>
              <th>Gyro X</th>
              <th>Gyro Y</th>
              <th>Gyro Z</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="7">Loading...</td></tr>
          </tbody>
        </table>
        <div class="pagination">
          <button onclick="prevPage()">‚¨ÖÔ∏è Previous</button>
          <span id="page-num">Page 1</span>
          <button onclick="nextPage()">Next ‚û°Ô∏è</button>
        </div>
      </section>

      <!-- Page 2: Graph (Placeholder) -->
      <section id="graph-page" style="display: none;">
        <h2>üìà Sensor Graph</h2>
        <p>üõ†Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤... (mock-up ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á)</p>
      </section>

      <!-- Page 3: ESP32-CAM (Placeholder) -->
      <section id="stream-page" style="display: none;">
        <h2>üì∑ ESP32-CAM Stream</h2>
        <p>üõ†Ô∏è ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ï‡∏£‡∏µ‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å ESP32-CAM</p>
        <p>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: <code>&lt;img src="http://IP_ESP32_CAM/video" /&gt;</code></p>
      </section>
    </main>
  </div>

  <script>
    const apiURL = "https://test-flask-mongo.onrender.com/data";
    let currentPage = 1;

    function showPage(pageId) {
      document.querySelectorAll("main section").forEach(s => s.style.display = "none");
      document.querySelector(`#${pageId}-page`).style.display = "block";

      document.querySelectorAll("aside li").forEach(li => li.classList.remove("active"));
      document.querySelectorAll("aside li").forEach(li => {
        if (li.textContent.includes(pageId.charAt(0).toUpperCase())) li.classList.add("active");
      });

      if (pageId === "log") updateTable();
    }

    async function fetchData(page = 1) {
      try {
        const response = await fetch(`${apiURL}?page=${page}&page_size=10`);
        return await response.json();
      } catch (error) {
        console.error("‚ùå Error fetching data:", error);
        return [];
      }
    }

    async function updateTable() {
      const data = await fetchData(currentPage);
      document.getElementById("page-num").textContent = `Page ${currentPage}`;
      const tableBody = document.querySelector("#data-table tbody");
      tableBody.innerHTML = "";

      if (data.length === 0) {
        tableBody.innerHTML = "<tr><td colspan='7'>No data found</td></tr>";
        return;
      }

      data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.timestamp}</td>
          <td>${row.accel_x}</td>
          <td>${row.accel_y}</td>
          <td>${row.accel_z}</td>
          <td>${row.gyro_x}</td>
          <td>${row.gyro_y}</td>
          <td>${row.gyro_z}</td>
        `;
        tableBody.appendChild(tr);
      });
    }

    function nextPage() {
      currentPage++;
      updateTable();
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        updateTable();
      }
    }

    // Load first time
    updateTable();
  </script>
</body>
</html>
