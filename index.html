<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“Š Real-time Sensor Dashboard (MPU1 & MPU2)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; display: flex; }
    nav {
      width: 200px; background-color: #2c3e50; color: white;
      height: 100vh; padding-top: 1em;
    }
    nav a {
      display: block; padding: 1em; text-decoration: none; color: white;
    }
    nav a:hover { background-color: #34495e; }
    main {
      flex-grow: 1; padding: 2em; background-color: #f4f4f4;

    }
    table {
      width: 100%; border-collapse: collapse; margin-top: 1em;
@@ -24,15 +25,20 @@
    }
    th { background-color: #4CAF50; color: white; }
    .pagination button { margin: 0.5em; }
    canvas { max-width: 100%; }

  </style>
</head>
<body>
<nav>
  <a href="#" onclick="showPage('log')">Log Table</a>
  <a href="#" onclick="showPage('graph')">Sensor Graphs</a>
</nav>
<main>
  <section id="log-page">
    <h2>ðŸ“‹ Sensor Log</h2>
    <table>
@@ -52,6 +58,7 @@ <h2>ðŸ“‹ Sensor Log</h2>
    </div>
  </section>
  <section id="graph-page" style="display:none">
    <h2>ðŸ“ˆ Real-time Graphs</h2>
    <h3>MPU1 - Accelerometer</h3>
@@ -63,19 +70,39 @@ <h3>MPU2 - Accelerometer</h3>
    <h3>MPU2 - Gyroscope</h3>
    <canvas id="mpu2Gyro"></canvas>
  </section>
</main>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const apiBase = "https://test-flask-mongo.onrender.com";  // âœ… à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ URL à¸•à¸²à¸¡à¸‚à¸­à¸‡à¸„à¸¸à¸“
  let allData = [];
  let currentPage = 1;
  const rowsPerPage = 10;
  let maxPages = 1;
  let charts = {};

  function isNewEntry(entry) {
    return !allData.some(d => d.timestamp === entry.timestamp);


  }

  async function fetchAndUpdate() {
@@ -84,24 +111,20 @@ <h3>MPU2 - Gyroscope</h3>
      const latest = await res.json();

      latest.forEach(entry => {
      if (isNewEntry(entry)) {
      allData.unshift(entry);  // âœ… à¹€à¸žà¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆà¸ªà¸¸à¸”à¹„à¸§à¹‰à¸šà¸™à¸ªà¸¸à¸”à¸‚à¸­à¸‡ array
      }
      });

      // à¸ˆà¸³à¸à¸±à¸”à¹„à¸§à¹‰à¸—à¸µà¹ˆ 500 à¸£à¸²à¸¢à¸à¸²à¸£
      if (allData.length > 500) {
        allData = allData.slice(0, 500);
      }

      maxPages = Math.ceil(allData.length / rowsPerPage);

      if (currentPage === 1) {
        renderTable();
      }

    } catch (err) {
      console.error("Error fetching latest:", err);
    }
  }

@@ -134,28 +157,24 @@ <h3>MPU2 - Gyroscope</h3>
    renderTable();
  }

  function showPage(id) {
    document.getElementById("log-page").style.display = id === "log" ? "block" : "none";
    document.getElementById("graph-page").style.display = id === "graph" ? "block" : "none";
  }

  async function updateGraphs() {
    try {
      const res = await fetch(`${apiBase}/latest`);
      const data = await res.json();

      const labels = data.map(d => d.timestamp);

      const keys = [
        ["mpu1Accel", ["mpu1_ax", "mpu1_ay", "mpu1_az"], ["red", "green", "blue"]],
        ["mpu1Gyro", ["mpu1_gx", "mpu1_gy", "mpu1_gz"], ["orange", "purple", "brown"]],
        ["mpu2Accel", ["mpu2_ax", "mpu2_ay", "mpu2_az"], ["pink", "teal", "gray"]],
        ["mpu2Gyro", ["mpu2_gx", "mpu2_gy", "mpu2_gz"], ["cyan", "magenta", "gold"]]
      ];

      keys.forEach(([id, fields, colors]) => {
        const datasets = fields.map((f, i) => ({
          label: f, borderColor: colors[i], fill: false,
          data: data.map(d => d[f])
        }));

@@ -178,14 +197,36 @@ <h3>MPU2 - Gyroscope</h3>
    }
  }
  // à¹€à¸£à¸´à¹ˆà¸¡à¹‚à¸«à¸¥à¸”
  fetchAndUpdate();
  updateGraphs();
  // à¹€à¸£à¸µà¸¢à¸à¸‹à¹‰à¸³à¸—à¸¸à¸ 2 à¸§à¸´
  setInterval(() => {
    fetchAndUpdate();
    updateGraphs();
  }, 2000);
</script>
</body>
